import{p as S}from"./index.a31f2cbe.js";import{N as w,Y as h}from"./scheduler.e2128b0a.js";import{l as p,e as c}from"./index.027ae11e.js";function d(){const{subscribe:e,update:r}=S("bpa:transfersStore",{});return{subscribe:e,addTransfer:({homeDomain:t,protocol:a,assetCode:s,transferID:n})=>r(o=>{let i={...o};return t in i?a in i[t]?i[t][a].push({id:n,asset_code:s}):i[t][a]=[{id:n,asset_code:s}]:i[t]={[a]:[{id:n,asset_code:s}]},i})}}const R=d();function T(){const{subscribe:e,update:r}=S("bpa:webAuthStore",{});return{subscribe:e,setAuth:(t,a)=>r(s=>({...s,[t]:a})),isTokenExpired:t=>{let a=w(m)[t];if(a){let s=JSON.parse(h.Buffer.from(a.split(".")[1],"base64").toString());return Math.floor(Date.now()/1e3)>s.exp}else return}}}const m=T();async function l(e){return await p.StellarTomlResolver.resolve(e)}async function f(e){let{TRANSFER_SERVER:r}=await l(e);return r}async function u(e){let{TRANSFER_SERVER_SEP0024:r}=await l(e);return r}async function g(e){let{KYC_SERVER:r,TRANSFER_SERVER:t}=await l(e);return r??t}async function $(e){let{WEB_AUTH_ENDPOINT:r}=await l(e);return r}async function b(e){let r=await u(e),t=await fetch(`${r}/info`),a=await t.json();if(t.ok)return a;throw c(t.status,{message:a.error})}async function v({authToken:e,endpoint:r,homeDomain:t,urlFields:a={}}){let s=await u(t),n=await fetch(`${s}/transactions/${r}/interactive`,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(a)}),o=await n.json();if(n.ok)return o;throw c(n.status,{message:o.error})}async function A({authToken:e,assetCode:r,homeDomain:t}){let a=await u(t),s=await fetch(`${a}/transactions?${new URLSearchParams({asset_code:r})}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}),n=await s.json();if(s.ok)return n;throw c(s.status,{message:n.error})}async function _(e){let r=await f(e);return await(await fetch(`${r}/info`)).json()}async function k({authToken:e,endpoint:r,formData:t,domain:a}){let s=await f(a);console.log("here is all the formData",t);let n=new URLSearchParams(t),o=await fetch(`${s}/${r}?${n}`,{method:"GET",mode:"cors",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}),i=await o.json();if(o.ok)return i;throw c(o.status,{message:i.error})}async function N({authToken:e,transferId:r,domain:t}){let a=await f(t),s=await fetch(`${a}/transaction?${new URLSearchParams({id:r})}`,{method:"GET",mode:"cors",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}),n=await s.json();if(s.ok){let{transaction:o}=n;return o}else throw c(s.status,{message:n.error})}async function P({authToken:e,assetCode:r,publicKey:t,homeDomain:a}){let s=await f(a),n=await fetch(`${s}/transactions?${new URLSearchParams({asset_code:r,account:t})}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}),o=await n.json();if(n.ok)return o;throw c(n.status,{message:o.error})}export{A as a,N as b,$ as c,v as d,_ as e,l as f,g,b as h,k as i,P as q,R as t,m as w};
